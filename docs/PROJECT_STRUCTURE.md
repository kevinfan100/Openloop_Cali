# Project Structure
# Openloop_Cali 專案結構說明

**Last Updated**: 2025-10-09
**Project**: Digital Control System Framework for MIMO Plant

---

## 📂 Directory Structure

```
Openloop_Cali/
│
├── 📄 Control_System_Framework.slx    # ⭐ Main Simulink framework
├── 📄 generate_simulink_framework.m   # Framework generator script
│
├── 📄 Model_6_6_Continuous_Weighted.m # Plant model definition (36 TFs)
├── 📄 P1.m ~ P6.m                     # Individual channel plant parameters
├── 📦 one_curve_36_results.mat        # ⭐ Plant fitting results (IMPORTANT!)
│
├── 📁 controllers/                    # Controller Simulink models
│   ├── PI_controller.slx
│   └── (other controller models)
│
├── 📁 scripts/                        # Core MATLAB scripts
│   │
│   ├── 📁 framework/                  # Simulink interaction scripts
│   │   ├── setup_controller.m        # Integrate controller into framework
│   │   ├── run_simulation.m          # Run Simulink simulation
│   │   └── analyze_results.m         # Analyze simulation results
│   │
│   ├── 📁 design/                     # Controller design scripts
│   │   ├── design_PI_frequency.m     # Frequency-domain PI design
│   │   ├── analyze_plant_frequency.m # Plant frequency analysis
│   │   ├── example_frequency_design.m # Complete design example
│   │   └── example_run_PI.m          # PI controller test example
│   │
│   └── 📁 results/                    # Simulation results & plots
│       ├── *.mat                      # Result data files
│       ├── *.fig                      # MATLAB figures
│       └── *.png                      # Exported plots
│
├── 📁 docs/                           # Documentation
│   ├── PROJECT_STRUCTURE.md           # This file
│   ├── DEVELOPMENT_RULES.md           # Development guidelines
│   ├── 控制器開發與Git管理策略.md
│   ├── generate_simulink_framework.md
│   └── MATLAB_Simulink_互動基礎教學.md
│
├── 📁 Mathematical_Derivation/        # Mathematical theory & derivations
│   └── (LaTeX/Markdown math documents)
│
├── 📁 Log/                            # Execution logs (not committed)
│
├── 📄 .gitignore                      # Git ignore rules
└── 📄 README.md                       # (To be created)
```

---

## 🎯 File Descriptions

### Root Level Files

#### ⭐ **Control_System_Framework.slx**
- **Purpose**: Main Simulink model for the control system
- **Interface**:
  - **Inputs**:
    - `From_Vd` (6×1) - Reference signal via Goto/From
    - `From_Vm` (6×1) - Measured signal via Goto/From
    - `u_in` (6×1) - Control signal input port
  - **Outputs**:
    - `Vm` (6×1) - Measured output
- **Contains**: DAC, Plant (36 TFs), ADC, monitoring blocks
- **Generated by**: `generate_simulink_framework.m`

#### **generate_simulink_framework.m**
- **Purpose**: Programmatically creates the Simulink framework
- **Usage**: `generate_simulink_framework()`
- **Prerequisites**: `one_curve_36_results.mat` must exist
- **Output**: `Control_System_Framework.slx`

#### **Model_6_6_Continuous_Weighted.m**
- **Purpose**: Performs plant identification (multi-curve fitting)
- **Output**: `one_curve_36_results.mat`
- **Method**: Fits 36 second-order transfer functions (6×6 MIMO)

#### **P1.m ~ P6.m**
- **Purpose**: Individual plant parameter definitions for each channel
- **Format**: Contains `a1`, `a2`, `b` coefficients for each TF

#### ⭐ **one_curve_36_results.mat**
- **Purpose**: Stores fitted plant parameters
- **Contents**: `a1_matrix` (6×6), `a2_matrix` (6×6), `b_matrix` (6×6)
- **IMPORTANT**: This file MUST be present for framework generation

---

### Controllers Directory

```
controllers/
├── PI_controller.slx          # PI controller model
└── (future controllers)
```

**Purpose**: Contains Simulink controller models that can be integrated into the framework

**Integration**: Use `scripts/framework/setup_controller.m` to connect controllers

---

### Scripts Directory

#### 📁 **scripts/framework/**
Scripts for interacting with the Simulink framework.

| File | Purpose | Usage |
|------|---------|-------|
| `setup_controller.m` | Integrate controller into framework | `setup_controller('PI_controller', params)` |
| `run_simulation.m` | Execute Simulink simulation | `results = run_simulation(model_name, sim_time, options)` |
| `analyze_results.m` | Analyze simulation outputs | `perf = analyze_results(sim_results, Vd_ref, options)` |

#### 📁 **scripts/design/**
Scripts for controller design and analysis.

| File | Purpose | Key Function |
|------|---------|--------------|
| `design_PI_frequency.m` | Frequency-domain PI design | `[Kp, Ki, info] = design_PI_frequency(plant_info, wc, PM, options)` |
| `analyze_plant_frequency.m` | Analyze plant frequency response | `plant_info = analyze_plant_frequency(ch_out, ch_in)` |
| `example_frequency_design.m` | Complete design workflow example | Run as script |
| `example_run_PI.m` | PI controller test example | Run as script |

#### 📁 **scripts/results/**
Stores simulation results, plots, and analysis outputs.

- `*.mat` - Simulation data
- `*.fig` - MATLAB figures (editable)
- `*.png` - Exported plots (for reports)

---

### Documentation Directory

```
docs/
├── PROJECT_STRUCTURE.md               # This file
├── DEVELOPMENT_RULES.md               # Coding standards & Git workflow
├── 控制器開發與Git管理策略.md           # Controller development guide
├── generate_simulink_framework.md     # Framework generation guide
└── MATLAB_Simulink_互動基礎教學.md     # MATLAB/Simulink basics
```

**Purpose**: All project documentation, guides, and tutorials.

---

## 🔄 Typical Workflows

### 1. **Generate Framework from Scratch**

```matlab
% Step 1: Run plant identification (if needed)
Model_6_6_Continuous_Weighted

% Step 2: Generate Simulink framework
generate_simulink_framework()

% Step 3: Open and inspect
open_system('Control_System_Framework')
```

### 2. **Design a New Controller**

```matlab
% Step 1: Analyze plant
addpath('scripts/design')
plant_info = analyze_plant_frequency(1, 1);  % Channel 1

% Step 2: Design controller
wc_desired = plant_info.frequency.w_nominal;
PM_desired = 60;  % degrees
[Kp, Ki, design_info] = design_PI_frequency(plant_info, wc_desired, PM_desired);

% Step 3: Build 6×6 parameters
Kp_matrix = diag([Kp, Kp, Kp, Kp, Kp, Kp]);
Ki_matrix = diag([Ki, Ki, Ki, Ki, Ki, Ki]);
```

### 3. **Integrate and Test Controller**

```matlab
% Step 1: Setup controller
addpath('scripts/framework')
params.Kp = Kp_matrix;
params.Ki = Ki_matrix;
params.Ts_controller = 1e-5;
setup_controller('PI_controller', params);

% Step 2: Run simulation
sim_time = 0.01;  % 10 ms
sim_results = run_simulation('Control_System_Framework', sim_time);

% Step 3: Analyze results
Vd_ref = [1; 1; 1; 1; 1; 1];
performance = analyze_results(sim_results, Vd_ref);
```

### 4. **Complete Design Example**

```matlab
% Run the complete workflow
addpath('scripts/design')
example_frequency_design
```

---

## 📊 Data Flow

```
┌─────────────────────────────────────────────────────────────┐
│  1. Plant Identification                                    │
│     Model_6_6_Continuous_Weighted.m                         │
│              ↓                                              │
│     one_curve_36_results.mat (36 TFs)                       │
└─────────────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────────┐
│  2. Framework Generation                                    │
│     generate_simulink_framework.m                           │
│              ↓                                              │
│     Control_System_Framework.slx                            │
└─────────────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────────┐
│  3. Controller Design                                       │
│     analyze_plant_frequency.m (analyze)                     │
│     design_PI_frequency.m (design)                          │
│              ↓                                              │
│     Controller Parameters (Kp, Ki)                          │
└─────────────────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────────┐
│  4. Integration & Simulation                                │
│     setup_controller.m (integrate)                          │
│     run_simulation.m (simulate)                             │
│     analyze_results.m (analyze)                             │
│              ↓                                              │
│     Results (plots, performance metrics)                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚀 Quick Start Guide

### For New Users

1. **Check Prerequisites**
   ```matlab
   % Ensure plant data exists
   if ~exist('one_curve_36_results.mat', 'file')
       error('Run Model_6_6_Continuous_Weighted.m first!');
   end
   ```

2. **Generate Framework**
   ```matlab
   generate_simulink_framework()
   ```

3. **Run Example**
   ```matlab
   addpath('scripts/design')
   example_frequency_design
   ```

### For Development

1. **Read Documentation**
   - [DEVELOPMENT_RULES.md](DEVELOPMENT_RULES.md) - Coding standards
   - [控制器開發與Git管理策略.md](控制器開發與Git管理策略.md) - Development guide

2. **Follow File Organization**
   - Framework interaction → `scripts/framework/`
   - Controller design → `scripts/design/`
   - Documentation → `docs/`

3. **Use Git Properly**
   - No temporary files (`*_temp.m`, `*_v2.m`)
   - No manual version iterations
   - Follow commit message format

---

## 📝 Notes

### What to Commit
✅ **Always commit**:
- `Control_System_Framework.slx`
- `one_curve_36_results.mat`
- `P1.m ~ P6.m`
- Core scripts in `scripts/framework/` and `scripts/design/`
- All documentation in `docs/`
- Controllers in `controllers/`

❌ **Never commit**:
- Temporary files (`*_temp.m`, `*_test.m`, `check_*.m`)
- Version iterations (`*_v2.m`, `*_old.m`)
- Large result files (`.mat`, `.fig` in `scripts/results/`)
- Logs and debug outputs

### Important Files

| File | Purpose | Can Delete? |
|------|---------|-------------|
| `Control_System_Framework.slx` | Main framework | ❌ NO |
| `one_curve_36_results.mat` | Plant parameters | ❌ NO |
| `generate_simulink_framework.m` | Framework generator | ❌ NO |
| `P1.m ~ P6.m` | Plant definitions | ❌ NO |
| `scripts/framework/*.m` | Core framework scripts | ❌ NO |
| `scripts/design/*.m` | Core design scripts | ❌ NO |
| `docs/*.md` | Documentation | ❌ NO |
| `scripts/results/*.mat` | Simulation results | ✅ Yes (after archiving) |
| Log files | Execution logs | ✅ Yes |

---

## 🔗 Related Documents

- [DEVELOPMENT_RULES.md](DEVELOPMENT_RULES.md) - Development guidelines
- [控制器開發與Git管理策略.md](控制器開發與Git管理策略.md) - Controller development
- [generate_simulink_framework.md](generate_simulink_framework.md) - Framework generation details

---

## 📅 Version History

| Date       | Version | Changes                                    |
|------------|---------|-------------------------------------------|
| 2025-10-09 | 1.0     | Initial project structure documentation   |
| 2025-10-09 | 1.1     | Added file reorganization (framework/design split) |

---

**Maintained by**: Control System Development Team
**Contact**: (Add contact information)
