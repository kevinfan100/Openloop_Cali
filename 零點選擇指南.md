# PI 控制器零點選擇指南

## 根據你的根軌跡圖選擇最佳零點

---

## 📊 你的四個設計分析

### 系統資訊
- **受控體**: H(s) = 1.1592×10⁷ / (s² + 6.6172×10³s + 1.1592×10⁷)
- **受控體極點**: s = -3308.60 ± 803.22j
- **測試零點**: zc = [1000, 2000, 2500, 3500]

---

## 🔍 觀察關鍵指標

### 1. **Y 軸範圍（虛軸範圍）**

| 零點 zc | Y 軸範圍 (約) | 震盪程度 |
|---------|--------------|---------|
| 1000    | ±1.5×10⁴     | 大      |
| 2000    | ±2×10⁴       | 較大    |
| 2500    | ±6000        | 中等    |
| 3500    | ±3000        | 最小    |

**解讀**：
- Y 軸範圍越大 = 閉迴路極點虛部越大 = **震盪越嚴重**
- 從圖中看，**zc = 2500** 的 Y 軸範圍適中，震盪程度合理

### 2. **根軌跡形狀**

#### zc = 1000（太小）
- ❌ 根軌跡離虛軸太近
- ❌ 從原點出發的分支移動緩慢
- ❌ 閉迴路極點會有較大虛部
- **結論**: 響應慢，震盪大

#### zc = 2000（良好）
- ✅ 根軌跡形狀平衡
- ✅ 從原點出發的分支向左移動到零點
- ✅ 其他兩支往左上/左下移動，但不會太遠
- **結論**: 較佳設計

#### zc = 2500（良好）
- ✅ 根軌跡形狀最佳
- ✅ Y 軸範圍適中
- ✅ 閉迴路極點位置合理
- **結論**: **推薦此設計**

#### zc = 3500（太大）
- ⚠️ 零點接近受控體極點實部
- ⚠️ 根軌跡往虛軸方向偏離
- ⚠️ Y 軸範圍雖然小，但可能響應較慢
- **結論**: 可接受但不是最佳

---

## ⭐ 推薦選擇

### **最佳零點：zc = 2500**

#### 理由：
1. **Y 軸範圍適中**：閉迴路極點不會有過大虛部
2. **根軌跡形狀良好**：三個分支都朝合理方向移動
3. **平衡設計**：既不會太靠近原點（慢），也不會太遠離（震盪大）

### **備選零點：zc = 2000**

#### 理由：
1. 也是不錯的選擇
2. 稍微保守一點（離受控體極點遠一些）
3. 如果 zc=2500 測試後震盪太大，可以試試 zc=2000

---

## 🎯 如何決定 Kp 值

選定零點後，需要選擇合適的 Kp 值。

### 方法 1：使用更新後的腳本標記特定 Kp

1. 打開 `root_locus_multi_zeros.m`
2. 修改第 27 行：
   ```matlab
   Kp_mark = 5;  % 例如測試 Kp = 5
   ```
3. 重新執行腳本
4. 圖上會顯示 Kp=5 時的閉迴路極點位置（藍色方塊）

### 方法 2：使用 MATLAB rlocfind 函數

```matlab
% 在 MATLAB Command Window 中執行
zc = 2500;
C = tf([1, zc], [1, 0]);
H = tf(1.1592e7, [1, 6.6172e3, 1.1592e7]);
G = C * H;

% 繪製根軌跡
figure;
rlocus(G);

% 互動式選擇 Kp
[Kp, poles] = rlocfind(G);
% 點擊圖上你想要的閉迴路極點位置
% MATLAB 會顯示對應的 Kp 值
```

### 方法 3：根據性能指標計算

#### 3.1 阻尼比法（Damping Ratio）

如果你希望系統阻尼比 ζ = 0.7（臨界阻尼附近）：

```matlab
% 目標阻尼比線的角度
theta = acos(0.7);  % 約 45.6°

% 在根軌跡圖上畫阻尼比線
figure;
rlocus(G);
hold on;
sgrid(0.7, []);  % 畫 ζ=0.7 的線
```

選擇閉迴路極點在這條線上或以內的 Kp 值。

#### 3.2 自然頻率法（Natural Frequency）

如果你希望閉迴路系統自然頻率 ωn = 2000 rad/s：

```matlab
% 在根軌跡圖上畫等頻率圓
figure;
rlocus(G);
hold on;
sgrid([], 2000);  % 畫 ωn=2000 的圓
```

選擇閉迴路極點在這個圓上或以內的 Kp 值。

---

## 📝 實際測試步驟

### 步驟 1：選擇零點
推薦從 **zc = 2500** 開始

### 步驟 2：測試多個 Kp 值

修改腳本，比較不同 Kp：

```matlab
% 在 root_locus_multi_zeros.m 中
zc_array = [2500, 2500, 2500, 2500];  % 都用 zc=2500
Kp_array = [2, 5, 10, 15];            % 測試不同 Kp

% 修改循環，為每個 Kp 繪製閉迴路極點
```

或者手動測試：

```matlab
zc = 2500;
C = tf([1, zc], [1, 0]);
H = tf(1.1592e7, [1, 6.6172e3, 1.1592e7]);
G = C * H;

% 測試 Kp = 5
Kp = 5;
G_cl = feedback(Kp * G, 1);
poles_cl = pole(G_cl);
fprintf('Closed-loop poles at Kp=%.1f:\n', Kp);
for i = 1:length(poles_cl)
    fprintf('  s%d = %.2f %+.2fj\n', i, real(poles_cl(i)), imag(poles_cl(i)));
end

% 檢查阻尼比和自然頻率
wn = abs(poles_cl(1));
zeta = -real(poles_cl(1)) / wn;
fprintf('  Natural frequency: %.2f rad/s\n', wn);
fprintf('  Damping ratio: %.2f\n', zeta);
```

### 步驟 3：評估性能

選擇的 Kp 應該使閉迴路極點滿足：

1. **穩定性**：實部 < 0（必須）
2. **響應速度**：實部越負越快（建議 < -1000）
3. **震盪程度**：阻尼比 ζ ≈ 0.5-0.7（視需求）
4. **自然頻率**：ωn ≈ 2000-4000 rad/s（視需求）

---

## 🧮 快速估算公式

對於 PI 控制器 C(s) = Kp(s + zc)/s：

### 當 Kp 很小時
- 閉迴路極點接近開迴路極點
- 一個極點在 s ≈ 0 附近（慢）
- 兩個極點在受控體極點附近

### 當 Kp 增大時
- 從原點出發的極點往 s = -zc 移動（變快）
- 從受控體極點出發的兩個極點沿著漸近線移動

### 當 Kp 很大時
- 一個極點在 s ≈ -zc（由 PI 零點決定）
- 兩個極點往無窮遠移動（虛部增大，震盪增大）

---

## ⚠️ 常見錯誤

### 1. 零點太小（如 zc = 500）
- ❌ 閉迴路極點移動太慢
- ❌ 需要很大的 Kp 才能有好的性能
- ❌ 可能導致過度震盪

### 2. 零點太大（如 zc = 5000）
- ❌ PI 控制器效果有限（接近 P 控制器）
- ❌ 穩態誤差可能無法完全消除
- ❌ 積分作用太弱

### 3. Kp 太小
- ❌ 響應太慢
- ❌ 調節時間太長

### 4. Kp 太大
- ❌ 過度震盪
- ❌ 可能不穩定
- ❌ 實際系統可能飽和

---

## 📚 進階技巧

### 使用 MATLAB Control System Designer

```matlab
% 打開互動式設計工具
controlSystemDesigner(H)

% 或
sisotool(H)
```

這個工具可以讓你：
- 互動式拖動根軌跡上的極點
- 自動計算對應的 Kp
- 即時看到步階響應
- 調整 PI 零點位置並看到效果

### 自動最佳化

如果你有明確的性能指標（如超調量 < 10%，調節時間 < 0.1s）：

```matlab
% 使用優化工具箱
% 定義目標函數（最小化超調量和調節時間）
% 自動搜索最佳 zc 和 Kp
```

---

## 🎓 總結

### 快速決策表

| 需求 | 推薦 zc | 推薦 Kp 範圍 |
|------|---------|-------------|
| 快速響應，可接受震盪 | 2500-3000 | 8-15 |
| 平衡設計 | 2000-2500 | 5-10 |
| 最小震盪 | 1500-2000 | 3-8 |

### 你的系統推薦
- **零點**: zc = 2500
- **增益**: Kp = 5-10（需要測試確認）
- **理由**: 根軌跡形狀最佳，Y 軸範圍適中

### 下一步
1. 使用更新後的腳本，設定 `Kp_mark = 5`
2. 觀察閉迴路極點位置
3. 如果太靠近虛軸，減小 Kp
4. 如果太接近開迴路極點，增大 Kp
5. 最終在模擬或實際系統上驗證

---

**最後更新**: 2025-10-12
**作者**: Claude Code
